<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>NEXORY Platform — Dashboard</title>
  <link rel="stylesheet" href="../css/reset.css" />
  <link rel="stylesheet" href="../css/theme-nexory.css" />
</head>
<body>

  <!-- HEADER -->
  <header class="nx-header">
    <div class="nx-container nx-header-inner">
      <a href="../index.html" class="nx-brand">
        <img src="../assets/img/logo/nexory-logo.png" alt="NEXORY logo" class="nx-logo" />
        <span class="nx-brand-text">NEXORY</span>
      </a>

      <nav class="nx-nav">
        <a href="../index.html#about" class="nx-nav-link">About</a>
        <a href="../index.html#ecosystem" class="nx-nav-link">Ecosystem</a>
        <a href="../products/index.html" class="nx-nav-link">Products</a>
        <a href="../platform/index.html" class="nx-nav-link">Platform</a>
        <a href="../mobile/index.html" class="nx-nav-link">Mobile App</a>
        <a href="../index.html#contact" class="nx-nav-link nx-nav-link--accent">Contact</a>
      </nav>

      <button class="nx-burger" aria-label="Toggle menu">
        <span></span><span></span><span></span>
      </button>
    </div>
  </header>

  <!-- DASHBOARD HEADER -->
  <section class="nx-dashboard-header">
    <div class="nx-container">
      <h1 class="nx-dashboard-title">Dashboard</h1>
      <p class="nx-dashboard-subtitle">
        Demo dashboard: manage loads, drivers, trucks and requests directly in your browser
        (no backend yet).
      </p>

      <div class="nx-dashboard-nav">
        <a href="#" class="nx-dash-tab nx-dash-tab--active" data-tab="overview">Overview</a>
        <a href="#" class="nx-dash-tab" data-tab="loads">Loads</a>
        <a href="#" class="nx-dash-tab" data-tab="drivers">Drivers</a>
        <a href="#" class="nx-dash-tab" data-tab="trucks">Trucks</a>
        <a href="#" class="nx-dash-tab" data-tab="requests">Requests</a>
        <a href="#" class="nx-dash-tab" data-tab="documents">Documents</a>
        <a href="#" class="nx-dash-tab" data-tab="settings">Settings</a>
      </div>
    </div>
  </section>

  <!-- DASHBOARD CONTENT -->
  <main>
    <section class="nx-page-section">
      <div class="nx-container">

        <p class="nx-dashboard-hint" style="margin-bottom: 16px;">
          Demo only: all data is stored in browser memory and resets on refresh.
        </p>

        <div class="nx-dashboard-panels">

          <!-- OVERVIEW PANEL -->
          <div class="nx-dashboard-panel is-active" data-panel="overview">
            <h2 class="nx-section-title">Overview</h2>
            <p class="nx-section-text">
              Quick summary of all loads you create via <strong>Loads → New Load</strong>.
              Drivers, trucks and documents are linked to each load.
            </p>

            <div class="nx-table-wrapper">
              <table class="nx-table">
                <thead>
                  <tr>
                    <th>#</th>
                    <th>Load ID</th>
                    <th>Route</th>
                    <th>Driver</th>
                    <th>Truck</th>
                    <th>Status</th>
                    <th>Rate</th>
                    <th>Document</th>
                  </tr>
                </thead>
                <tbody id="loads-table-overview"></tbody>
              </table>
              <p class="nx-table-empty" id="loads-empty-overview">
                No loads yet. Go to <strong>Loads</strong> tab and click <strong>+ New Load</strong>.
              </p>
            </div>
          </div>

          <!-- LOADS PANEL -->
          <div class="nx-dashboard-panel" data-panel="loads">
            <div class="nx-dashboard-topbar" style="margin-top: 0;">
              <h2 class="nx-section-title" style="margin-bottom: 0;">Loads</h2>
              <button class="nx-btn nx-btn-primary" id="new-load-btn">+ New Load</button>
            </div>
            <p class="nx-section-text">
              Detailed list of all loads created in this session.
            </p>

            <div class="nx-table-wrapper">
              <table class="nx-table">
                <thead>
                  <tr>
                    <th>#</th>
                    <th>Load ID</th>
                    <th>Pickup</th>
                    <th>Delivery</th>
                    <th>Driver</th>
                    <th>Truck</th>
                    <th>Status</th>
                    <th>Rate</th>
                  </tr>
                </thead>
                <tbody id="loads-table-loads"></tbody>
              </table>
              <p class="nx-table-empty" id="loads-empty-loads">
                No loads yet. Use <strong>+ New Load</strong> to create one.
              </p>
            </div>
          </div>

          <!-- DRIVERS PANEL -->
          <div class="nx-dashboard-panel" data-panel="drivers">
            <div class="nx-dashboard-topbar" style="margin-top: 0;">
              <h2 class="nx-section-title" style="margin-bottom: 0;">Drivers</h2>
              <button class="nx-btn nx-btn-primary" id="new-driver-btn">+ Add new driver</button>
            </div>
            <p class="nx-section-text">
              Drivers created here can be assigned to loads and trucks.
            </p>

            <div class="nx-table-wrapper">
              <table class="nx-table">
                <thead>
                  <tr>
                    <th>#</th>
                    <th>Name</th>
                    <th>DL number</th>
                    <th>State</th>
                    <th>Phone</th>
                    <th>Email</th>
                  </tr>
                </thead>
                <tbody id="drivers-table-body"></tbody>
              </table>
              <p class="nx-table-empty" id="drivers-empty">
                No drivers yet. Click <strong>+ Add new driver</strong> to create one.
              </p>
            </div>
          </div>

          <!-- TRUCKS PANEL -->
          <div class="nx-dashboard-panel" data-panel="trucks">
            <div class="nx-dashboard-topbar" style="margin-top: 0;">
              <h2 class="nx-section-title" style="margin-bottom: 0;">Trucks</h2>
              <button class="nx-btn nx-btn-primary" id="new-truck-btn">+ Add new truck</button>
            </div>
            <p class="nx-section-text">
              Basic truck list with assigned driver. Later this area can grow into full fleet module.
            </p>

            <div class="nx-table-wrapper">
              <table class="nx-table">
                <thead>
                  <tr>
                    <th>#</th>
                    <th>Truck #</th>
                    <th>Model</th>
                    <th>Year</th>
                    <th>Plate</th>
                    <th>Driver</th>
                  </tr>
                </thead>
                <tbody id="trucks-table-body"></tbody>
              </table>
              <p class="nx-table-empty" id="trucks-empty">
                No trucks yet. Click <strong>+ Add new truck</strong> to create one.
              </p>
            </div>
          </div>

          <!-- REQUESTS PANEL -->
          <div class="nx-dashboard-panel" data-panel="requests">
            <div class="nx-dashboard-topbar" style="margin-top: 0;">
              <h2 class="nx-section-title" style="margin-bottom: 0;">Requests</h2>
              <button class="nx-btn nx-btn-primary" id="new-request-btn">+ New request</button>
            </div>
            <p class="nx-section-text">
              Simple demo of a request center (safety, claims, maintenance, accounting). In a real
              platform this would sync with chats and departments.
            </p>

            <div class="nx-table-wrapper">
              <table class="nx-table">
                <thead>
                  <tr>
                    <th>#</th>
                    <th>Type</th>
                    <th>Load ID</th>
                    <th>Status</th>
                    <th>Notes</th>
                  </tr>
                </thead>
                <tbody id="requests-table-body"></tbody>
              </table>
              <p class="nx-table-empty" id="requests-empty">
                No requests yet. Click <strong>+ New request</strong> to simulate one.
              </p>
            </div>
          </div>

          <!-- DOCUMENTS PANEL -->
          <div class="nx-dashboard-panel" data-panel="documents">
            <h2 class="nx-section-title">Documents</h2>
            <p class="nx-section-text">
              Each load can have one attached document (ratecon, BOL, POD). In this demo we store
              only the file name — real upload will appear when backend is connected.
            </p>
            <p class="nx-section-text">
              Use the <strong>Document</strong> column in Overview / Loads to see which loads have
              a file attached.
            </p>
          </div>

          <!-- SETTINGS PANEL -->
          <div class="nx-dashboard-panel" data-panel="settings">
            <h2 class="nx-section-title">Settings (concept)</h2>
            <p class="nx-section-text">
              This section sketches how settings could look in a real NEXORY Platform:
            </p>
            <ul class="nx-list nx-list-tight">
              <li><strong>General:</strong> company profile, time zone, currency, units.</li>
              <li><strong>Roles & permissions:</strong> dispatch, accounting, safety, read-only.</li>
              <li><strong>Notifications:</strong> which events trigger email / SMS / push.</li>
              <li><strong>Integrations:</strong> ELD, TMS, factoring, broker portals, NEXORY Bot.</li>
              <li><strong>Data & audit:</strong> export, logs, retention policies.</li>
            </ul>
          </div>

        </div>
      </div>
    </section>
  </main>

  <!-- MODAL: NEW LOAD -->
  <div class="nx-modal-backdrop" id="load-modal">
    <div class="nx-modal" role="dialog" aria-modal="true" aria-labelledby="load-modal-title">
      <div class="nx-modal-header">
        <h2 id="load-modal-title">New Load (demo)</h2>
        <button class="nx-modal-close" type="button" id="load-modal-close" aria-label="Close">
          &times;
        </button>
      </div>

      <form id="load-form" class="nx-modal-body">
        <div class="nx-field-row">
          <div class="nx-field">
            <label for="load-id">Load ID</label>
            <input id="load-id" name="loadId" type="text" placeholder="e.g. NXR-1001" required />
          </div>
          <div class="nx-field">
            <label for="status">Status</label>
            <select id="status" name="status">
              <option value="Planned">Planned</option>
              <option value="Dispatched">Dispatched</option>
              <option value="In transit">In transit</option>
              <option value="Delivered">Delivered</option>
            </select>
          </div>
        </div>

        <div class="nx-field-row">
          <div class="nx-field">
            <label for="pickup">Pickup location</label>
            <input id="pickup" name="pickup" type="text" placeholder="City, ST" required />
          </div>
          <div class="nx-field">
            <label for="delivery">Delivery location</label>
            <input id="delivery" name="delivery" type="text" placeholder="City, ST" required />
          </div>
        </div>

        <div class="nx-field-row">
          <div class="nx-field">
            <label for="pickup-date">Pickup date</label>
            <input id="pickup-date" name="pickupDate" type="date" />
          </div>
          <div class="nx-field">
            <label for="delivery-date">Delivery date</label>
            <input id="delivery-date" name="deliveryDate" type="date" />
          </div>
        </div>

        <div class="nx-field-row">
          <div class="nx-field">
            <label for="driver-select">Driver</label>
            <select id="driver-select" name="driverId"></select>
            <p class="nx-field-hint">
              Drivers are managed on the <strong>Drivers</strong> tab.
            </p>
          </div>
          <div class="nx-field">
            <label for="truck-select">Truck</label>
            <select id="truck-select" name="truckId"></select>
            <p class="nx-field-hint">
              Trucks are managed on the <strong>Trucks</strong> tab.
            </p>
          </div>
        </div>

        <div class="nx-field-row">
          <div class="nx-field">
            <label for="rate">Rate / payout ($)</label>
            <input id="rate" name="rate" type="number" min="0" step="0.01" placeholder="e.g. 1800" />
          </div>
          <div class="nx-field">
            <!-- пустой блок для выравнивания, можно потом использовать под miles -->
          </div>
        </div>

        <div class="nx-field">
          <label for="document">Document (ratecon / BOL / POD)</label>
          <input id="document" name="document" type="file" />
          <p class="nx-field-hint">
            In this demo file is not uploaded — only file name is stored in memory.
          </p>
        </div>

        <div class="nx-modal-footer">
          <button type="button" class="nx-btn nx-btn-ghost" id="load-modal-cancel">
            Cancel
          </button>
          <button type="submit" class="nx-btn nx-btn-primary">
            Save load
          </button>
        </div>
      </form>
    </div>
  </div>

  <!-- MODAL: NEW DRIVER -->
  <div class="nx-modal-backdrop" id="driver-modal">
    <div class="nx-modal" role="dialog" aria-modal="true" aria-labelledby="driver-modal-title">
      <div class="nx-modal-header">
        <h2 id="driver-modal-title">Add new driver</h2>
        <button class="nx-modal-close" type="button" id="driver-modal-close" aria-label="Close">
          &times;
        </button>
      </div>

      <form id="driver-form" class="nx-modal-body">
        <div class="nx-field-row">
          <div class="nx-field">
            <label for="driver-first-name">First name</label>
            <input id="driver-first-name" name="firstName" type="text" required />
          </div>
          <div class="nx-field">
            <label for="driver-last-name">Last name</label>
            <input id="driver-last-name" name="lastName" type="text" required />
          </div>
        </div>

        <div class="nx-field-row">
          <div class="nx-field">
            <label for="driver-dl">Driving licence number</label>
            <input id="driver-dl" name="dlNumber" type="text" />
          </div>
          <div class="nx-field">
            <label for="driver-state">State</label>
            <input id="driver-state" name="state" type="text" placeholder="e.g. IL" />
          </div>
        </div>

        <div class="nx-field-row">
          <div class="nx-field">
            <label for="driver-phone">Phone</label>
            <input id="driver-phone" name="phone" type="text" />
          </div>
          <div class="nx-field">
            <label for="driver-email">Email</label>
            <input id="driver-email" name="email" type="email" />
          </div>
        </div>

        <div class="nx-modal-footer">
          <button type="button" class="nx-btn nx-btn-ghost" id="driver-modal-cancel">
            Cancel
          </button>
          <button type="submit" class="nx-btn nx-btn-primary">
            Save driver
          </button>
        </div>
      </form>
    </div>
  </div>

  <!-- MODAL: NEW TRUCK -->
  <div class="nx-modal-backdrop" id="truck-modal">
    <div class="nx-modal" role="dialog" aria-modal="true" aria-labelledby="truck-modal-title">
      <div class="nx-modal-header">
        <h2 id="truck-modal-title">Add new truck</h2>
        <button class="nx-modal-close" type="button" id="truck-modal-close" aria-label="Close">
          &times;
        </button>
      </div>

      <form id="truck-form" class="nx-modal-body">
        <div class="nx-field-row">
          <div class="nx-field">
            <label for="truck-number">Truck #</label>
            <input id="truck-number" name="truckNumber" type="text" placeholder="e.g. 123456" required />
          </div>
          <div class="nx-field">
            <label for="truck-model">Model</label>
            <input id="truck-model" name="model" type="text" placeholder="e.g. Volvo VNL 760" />
          </div>
        </div>

        <div class="nx-field-row">
          <div class="nx-field">
            <label for="truck-year">Year</label>
            <input id="truck-year" name="year" type="number" min="1980" max="2100" />
          </div>
          <div class="nx-field">
            <label for="truck-plate">Plate</label>
            <input id="truck-plate" name="plate" type="text" />
          </div>
        </div>

        <div class="nx-field">
          <label for="truck-driver-select">Driver</label>
          <select id="truck-driver-select" name="driverId"></select>
          <p class="nx-field-hint">
            Optional: assign driver to this truck.
          </p>
        </div>

        <div class="nx-modal-footer">
          <button type="button" class="nx-btn nx-btn-ghost" id="truck-modal-cancel">
            Cancel
          </button>
          <button type="submit" class="nx-btn nx-btn-primary">
            Save truck
          </button>
        </div>
      </form>
    </div>
  </div>

  <!-- MODAL: NEW REQUEST -->
  <div class="nx-modal-backdrop" id="request-modal">
    <div class="nx-modal" role="dialog" aria-modal="true" aria-labelledby="request-modal-title">
      <div class="nx-modal-header">
        <h2 id="request-modal-title">New request (demo)</h2>
        <button class="nx-modal-close" type="button" id="request-modal-close" aria-label="Close">
          &times;
        </button>
      </div>

      <form id="request-form" class="nx-modal-body">
        <div class="nx-field-row">
          <div class="nx-field">
            <label for="request-type">Type</label>
            <select id="request-type" name="type">
              <option value="Safety">Safety</option>
              <option value="Claims">Claims</option>
              <option value="Maintenance">Maintenance</option>
              <option value="Accounting">Accounting</option>
              <option value="Other">Other</option>
            </select>
          </div>
          <div class="nx-field">
            <label for="request-load-id">Load ID (optional)</label>
            <input id="request-load-id" name="loadId" type="text" placeholder="e.g. NXR-1001" />
          </div>
        </div>

        <div class="nx-field">
          <label for="request-notes">Notes</label>
          <textarea id="request-notes" name="notes" rows="3"
            placeholder="Short description of the issue"></textarea>
        </div>

        <div class="nx-modal-footer">
          <button type="button" class="nx-btn nx-btn-ghost" id="request-modal-cancel">
            Cancel
          </button>
          <button type="submit" class="nx-btn nx-btn-primary">
            Save request
          </button>
        </div>
      </form>
    </div>
  </div>

  <!-- FOOTER -->
  <footer class="nx-footer">
    <div class="nx-container nx-footer-inner">
      <span>© <span id="year"></span> NEXORY. All rights reserved.</span>
      <span class="nx-footer-meta">AI • Logistics • Ecosystem • IT</span>
    </div>
  </footer>

  <script>
    // Year in footer
    document.getElementById("year").textContent = new Date().getFullYear();

    // Burger menu
    const burger = document.querySelector(".nx-burger");
    const nav = document.querySelector(".nx-nav");
    if (burger) {
      burger.addEventListener("click", () => {
        burger.classList.toggle("is-open");
        nav.classList.toggle("is-open");
      });
    }

    // Tabs
    const tabs = document.querySelectorAll(".nx-dash-tab");
    const panels = document.querySelectorAll(".nx-dashboard-panel");
    tabs.forEach((tab) => {
      tab.addEventListener("click", (e) => {
        e.preventDefault();
        const target = tab.dataset.tab;
        if (!target) return;
        tabs.forEach((t) => t.classList.remove("nx-dash-tab--active"));
        tab.classList.add("nx-dash-tab--active");
        panels.forEach((panel) => {
          panel.classList.toggle("is-active", panel.dataset.panel === target);
        });
      });
    });

    // In-memory stores
    const loads = [];
    const drivers = [];
    const trucks = [];
    const requests = [];
    let driverIdCounter = 1;
    let truckIdCounter = 1;
    let requestIdCounter = 1;

    // --- DOM references ---

    // Loads
    const tableOverview = document.getElementById("loads-table-overview");
    const tableLoads = document.getElementById("loads-table-loads");
    const emptyOverview = document.getElementById("loads-empty-overview");
    const emptyLoads = document.getElementById("loads-empty-loads");

    // Drivers
    const driversTableBody = document.getElementById("drivers-table-body");
    const driversEmpty = document.getElementById("drivers-empty");
    const driverSelectLoad = document.getElementById("driver-select");
    const driverSelectTruck = document.getElementById("truck-driver-select");

    // Trucks
    const trucksTableBody = document.getElementById("trucks-table-body");
    const trucksEmpty = document.getElementById("trucks-empty");
    const truckSelectLoad = document.getElementById("truck-select");

    // Requests
    const requestsTableBody = document.getElementById("requests-table-body");
    const requestsEmpty = document.getElementById("requests-empty");

    // --- render functions ---

    function renderDrivers() {
      if (!driversTableBody || !driversEmpty) return;
      driversTableBody.innerHTML = "";

      // clear selects
      if (driverSelectLoad) driverSelectLoad.innerHTML = "";
      if (driverSelectTruck) driverSelectTruck.innerHTML = "";

      if (!drivers.length) {
        driversEmpty.style.display = "block";

        if (driverSelectLoad) {
          const opt = document.createElement("option");
          opt.value = "";
          opt.textContent = "No drivers yet (add on Drivers tab)";
          opt.disabled = true;
          opt.selected = true;
          driverSelectLoad.appendChild(opt);
          driverSelectLoad.disabled = true;
        }
        if (driverSelectTruck) {
          const opt = document.createElement("option");
          opt.value = "";
          opt.textContent = "No drivers yet";
          opt.disabled = true;
          opt.selected = true;
          driverSelectTruck.appendChild(opt);
          driverSelectTruck.disabled = true;
        }
        return;
      }

      driversEmpty.style.display = "none";

      drivers.forEach((d, index) => {
        const tr = document.createElement("tr");
        tr.innerHTML = `
          <td>${index + 1}</td>
          <td>${d.firstName} ${d.lastName}</td>
          <td>${d.dlNumber || "—"}</td>
          <td>${d.state || "—"}</td>
          <td>${d.phone || "—"}</td>
          <td>${d.email || "—"}</td>
        `;
        driversTableBody.appendChild(tr);

        const opt1 = document.createElement("option");
        opt1.value = String(d.id);
        opt1.textContent = `${d.firstName} ${d.lastName}`;
        if (driverSelectLoad) driverSelectLoad.appendChild(opt1);

        const opt2 = document.createElement("option");
        opt2.value = String(d.id);
        opt2.textContent = `${d.firstName} ${d.lastName}`;
        if (driverSelectTruck) driverSelectTruck.appendChild(opt2);
      });

      if (driverSelectLoad) driverSelectLoad.disabled = false;
      if (driverSelectTruck) driverSelectTruck.disabled = false;
    }

    function renderTrucks() {
      if (!trucksTableBody || !trucksEmpty) return;
      trucksTableBody.innerHTML = "";
      if (truckSelectLoad) truckSelectLoad.innerHTML = "";

      if (!trucks.length) {
        trucksEmpty.style.display = "block";
        if (truckSelectLoad) {
          const opt = document.createElement("option");
          opt.value = "";
          opt.textContent = "No trucks yet (add on Trucks tab)";
          opt.disabled = true;
          opt.selected = true;
          truckSelectLoad.appendChild(opt);
          truckSelectLoad.disabled = true;
        }
        return;
      }

      trucksEmpty.style.display = "none";

      trucks.forEach((t, index) => {
        const driverName = t.driver ? `${t.driver.firstName} ${t.driver.lastName}` : "—";
        const tr = document.createElement("tr");
        tr.innerHTML = `
          <td>${index + 1}</td>
          <td>${t.truckNumber || "—"}</td>
          <td>${t.model || "—"}</td>
          <td>${t.year || "—"}</td>
          <td>${t.plate || "—"}</td>
          <td>${driverName}</td>
        `;
        trucksTableBody.appendChild(tr);

        const opt = document.createElement("option");
        opt.value = String(t.id);
        opt.textContent = t.truckNumber || t.model || `Truck ${t.id}`;
        if (truckSelectLoad) truckSelectLoad.appendChild(opt);
      });

      if (truckSelectLoad) truckSelectLoad.disabled = false;
    }

    function renderLoads() {
      if (!tableOverview || !tableLoads || !emptyOverview || !emptyLoads) return;
      tableOverview.innerHTML = "";
      tableLoads.innerHTML = "";

      if (!loads.length) {
        emptyOverview.style.display = "block";
        emptyLoads.style.display = "block";
        return;
      }

      emptyOverview.style.display = "none";
      emptyLoads.style.display = "none";

      loads.forEach((load, index) => {
        const driverName = load.driver ? `${load.driver.firstName} ${load.driver.lastName}` : "—";
        const truckLabel =
          load.truck && (load.truck.truckNumber || load.truck.model)
            ? `${load.truck.truckNumber || ""} ${load.truck.model || ""}`.trim()
            : "—";
        const rate = load.rate ? `$${load.rate}` : "—";

        // Overview row
        const tr1 = document.createElement("tr");
        tr1.innerHTML = `
          <td>${index + 1}</td>
          <td>${load.loadId || "—"}</td>
          <td>
            <div class="nx-cell-main">${load.pickup || "—"} → ${load.delivery || "—"}</div>
            <div class="nx-cell-sub">
              ${load.pickupDate || "?"} — ${load.deliveryDate || "?"}
            </div>
          </td>
          <td>${driverName}</td>
          <td>${truckLabel}</td>
          <td>
            <span class="nx-status-pill nx-status-${(load.status || "Planned")
              .toLowerCase()
              .replace(/\s+/g, "-")}">
              ${load.status || "Planned"}
            </span>
          </td>
          <td>${rate}</td>
          <td>${
            load.documentName
              ? `<span class="nx-doc-pill" title="${load.documentName}">${load.documentName}</span>`
              : "—"
          }</td>
        `;
        tableOverview.appendChild(tr1);

        // Loads tab row
        const tr2 = document.createElement("tr");
        tr2.innerHTML = `
          <td>${index + 1}</td>
          <td>${load.loadId || "—"}</td>
          <td>${load.pickup || "—"}</td>
          <td>${load.delivery || "—"}</td>
          <td>${driverName}</td>
          <td>${truckLabel}</td>
          <td>${load.status || "Planned"}</td>
          <td>${rate}</td>
        `;
        tableLoads.appendChild(tr2);
      });
    }

    function renderRequests() {
      if (!requestsTableBody || !requestsEmpty) return;
      requestsTableBody.innerHTML = "";

      if (!requests.length) {
        requestsEmpty.style.display = "block";
        return;
      }

      requestsEmpty.style.display = "none";

      requests.forEach((r, index) => {
        const tr = document.createElement("tr");
        tr.innerHTML = `
          <td>${index + 1}</td>
          <td>${r.type}</td>
          <td>${r.loadId || "—"}</td>
          <td>
            <span class="nx-status-pill nx-status-planned">Open</span>
          </td>
          <td>${r.notes || "—"}</td>
        `;
        requestsTableBody.appendChild(tr);
      });
    }

    // --- modal helpers ---

    function setupModal(openBtn, backdrop, closeBtn, cancelBtn) {
      if (!backdrop) return;
      const open = () => {
        backdrop.classList.add("is-open");
        document.body.classList.add("nx-modal-open");
      };
      const close = () => {
        backdrop.classList.remove("is-open");
        document.body.classList.remove("nx-modal-open");
      };
      if (openBtn) openBtn.addEventListener("click", open);
      if (closeBtn) closeBtn.addEventListener("click", close);
      if (cancelBtn) cancelBtn.addEventListener("click", close);
      backdrop.addEventListener("click", (e) => {
        if (e.target === backdrop) close();
      });
      return { open, close };
    }

    // Load modal
    const loadModal = document.getElementById("load-modal");
    const loadModalControl = setupModal(
      document.getElementById("new-load-btn"),
      loadModal,
      document.getElementById("load-modal-close"),
      document.getElementById("load-modal-cancel")
    );
    const loadForm = document.getElementById("load-form");

    // Driver modal
    const driverModal = document.getElementById("driver-modal");
    const driverModalControl = setupModal(
      document.getElementById("new-driver-btn"),
      driverModal,
      document.getElementById("driver-modal-close"),
      document.getElementById("driver-modal-cancel")
    );
    const driverForm = document.getElementById("driver-form");

    // Truck modal
    const truckModal = document.getElementById("truck-modal");
    const truckModalControl = setupModal(
      document.getElementById("new-truck-btn"),
      truckModal,
      document.getElementById("truck-modal-close"),
      document.getElementById("truck-modal-cancel")
    );
    const truckForm = document.getElementById("truck-form");

    // Request modal
    const requestModal = document.getElementById("request-modal");
    const requestModalControl = setupModal(
      document.getElementById("new-request-btn"),
      requestModal,
      document.getElementById("request-modal-close"),
      document.getElementById("request-modal-cancel")
    );
    const requestForm = document.getElementById("request-form");

    // --- form submits ---

    if (driverForm) {
      driverForm.addEventListener("submit", (e) => {
        e.preventDefault();
        const formData = new FormData(driverForm);
        const driver = {
          id: driverIdCounter++,
          firstName: (formData.get("firstName") || "").toString().trim(),
          lastName: (formData.get("lastName") || "").toString().trim(),
          dlNumber: (formData.get("dlNumber") || "").toString().trim(),
          state: (formData.get("state") || "").toString().trim(),
          phone: (formData.get("phone") || "").toString().trim(),
          email: (formData.get("email") || "").toString().trim()
        };
        drivers.push(driver);
        renderDrivers();
        driverForm.reset();
        if (driverModalControl) driverModalControl.close();
      });
    }

    if (truckForm) {
      truckForm.addEventListener("submit", (e) => {
        e.preventDefault();
        const formData = new FormData(truckForm);
        const driverId = formData.get("driverId");
        const driver =
          driverId && drivers.length
            ? drivers.find((d) => String(d.id) === String(driverId)) || null
            : null;

        const truck = {
          id: truckIdCounter++,
          truckNumber: (formData.get("truckNumber") || "").toString().trim(),
          model: (formData.get("model") || "").toString().trim(),
          year: (formData.get("year") || "").toString().trim(),
          plate: (formData.get("plate") || "").toString().trim(),
          driver
        };
        trucks.push(truck);
        renderTrucks();
        truckForm.reset();
        if (truckModalControl) truckModalControl.close();
      });
    }

    if (requestForm) {
      requestForm.addEventListener("submit", (e) => {
        e.preventDefault();
        const formData = new FormData(requestForm);
        const r = {
          id: requestIdCounter++,
          type: (formData.get("type") || "Other").toString(),
          loadId: (formData.get("loadId") || "").toString().trim(),
          notes: (formData.get("notes") || "").toString().trim()
        };
        requests.unshift(r);
        renderRequests();
        requestForm.reset();
        if (requestModalControl) requestModalControl.close();
      });
    }

    if (loadForm) {
      loadForm.addEventListener("submit", (e) => {
        e.preventDefault();
        const formData = new FormData(loadForm);
        const fileInput = document.getElementById("document");
        const file = fileInput && fileInput.files && fileInput.files[0];

        const driverId = formData.get("driverId");
        const truckId = formData.get("truckId");

        const driver =
          driverId && drivers.length
            ? drivers.find((d) => String(d.id) === String(driverId)) || null
            : null;

        const truck =
          truckId && trucks.length
            ? trucks.find((t) => String(t.id) === String(truckId)) || null
            : null;

        const load = {
          loadId: (formData.get("loadId") || "").toString().trim(),
          status: (formData.get("status") || "Planned").toString(),
          pickup: (formData.get("pickup") || "").toString().trim(),
          delivery: (formData.get("delivery") || "").toString().trim(),
          pickupDate: (formData.get("pickupDate") || "").toString(),
          deliveryDate: (formData.get("deliveryDate") || "").toString(),
          driver,
          truck,
          rate: (formData.get("rate") || "").toString().trim(),
          documentName: file ? file.name : ""
        };

        loads.unshift(load);
        renderLoads();
        loadForm.reset();
        if (loadModalControl) loadModalControl.close();
        // обновим селекты драйвера/трака после reset
        renderDrivers();
        renderTrucks();
      });
    }

    // Initial render
    renderDrivers();
    renderTrucks();
    renderLoads();
    renderRequests();
  </script>
</body>
</html>


